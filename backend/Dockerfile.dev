# Development Dockerfile with uv and hot reload support
FROM python:3.12-slim

# Install system dependencies (like ffmpeg)
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# Install uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /usr/local/bin/

# Set working directory
WORKDIR /app_backend

# Copy project files for dependency installation
COPY pyproject.toml uv.lock ./

# Install dependencies including dev dependencies
# Using --system flag since we're in a container
RUN uv sync --frozen --no-cache --system

# The application code will be mounted as volume in docker-compose
# This allows for hot reload during development

# Expose the port the app runs on
EXPOSE 8000

# Default command (will be overridden by docker-compose)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

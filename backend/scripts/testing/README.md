# ğŸ§ª Audio2Sub æµ‹è¯•å¥—ä»¶æ€»è§ˆ

è¿™æ˜¯ Audio2Sub é¡¹ç›®çš„å®Œæ•´æµ‹è¯•æ¡†æ¶ï¼ŒåŒ…å«ç”Ÿäº§ç¯å¢ƒéªŒè¯ã€å¼€å‘è°ƒè¯•å·¥å…·å’Œå†å²å½’æ¡£ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/testing/
â”œâ”€â”€ production/          # ğŸš€ ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒæµ‹è¯•
â”‚   â”œâ”€â”€ README.md        # ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æŒ‡å—
â”‚   â”œâ”€â”€ test_local_models.py     # â­ æœ¬åœ°æ¨¡å‹æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_curl.sh         # â­ API ç«¯ç‚¹éªŒè¯æµ‹è¯•
â”‚   â””â”€â”€ test_real_chinese_audio.py # â­ ä¸­æ–‡è¯­éŸ³ä¸“é¡¹æµ‹è¯•
â”œâ”€â”€ development/         # ğŸ”§ å¼€å‘ç¯å¢ƒè°ƒè¯•å·¥å…·
â”‚   â”œâ”€â”€ README.md        # å¼€å‘æµ‹è¯•æŒ‡å—
â”‚   â”œâ”€â”€ test_model_selection_api.py  # å®Œæ•´ API åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_simple_api.py          # å¿«é€ŸåŠŸèƒ½éªŒè¯
â”‚   â””â”€â”€ debug_chinese_transcription.py # ä¸­æ–‡è½¬å½•è°ƒè¯•
â”œâ”€â”€ archived/           # ğŸ“¦ å†å²å½’æ¡£
â”‚   â”œâ”€â”€ README.md       # å½’æ¡£è¯´æ˜æ–‡æ¡£
â”‚   â””â”€â”€ *.py           # å†å²æµ‹è¯•è„šæœ¬
â”œâ”€â”€ test_api_frontend.js # ğŸŒ å‰ç«¯æµ‹è¯•åº“
â”œâ”€â”€ test_api_page.html  # ğŸ“± å¯è§†åŒ–æµ‹è¯•é¡µé¢
â””â”€â”€ README.md          # ğŸ“‹ æœ¬æ–‡æ¡£
```

## â­ æ ¸å¿ƒæµ‹è¯•è„šæœ¬ (ç”Ÿäº§çº§åˆ«)

### 1. ğŸ“Š `production/test_local_models.py` - æ€§èƒ½åŸºå‡†æµ‹è¯•
**ç”¨é€”**: æµ‹è¯•æœ¬åœ°å·²ä¸‹è½½çš„å››ä¸ªæ¨¡å‹çš„æ€§èƒ½è¡¨ç°

**æ”¯æŒæ¨¡å‹**:
- `tiny` (39MB) - æœ€å¿«é€Ÿåº¦ï¼Œé€‚åˆå®æ—¶å¤„ç†
- `base` (142MB) - å¹³è¡¡æ¨èï¼Œæ—¥å¸¸ä½¿ç”¨
- `small` (466MB) - é«˜è´¨é‡è½¬å½•
- `large-v3-turbo` (809MB) - å¿«é€Ÿé«˜è´¨é‡

**æµ‹è¯•é…ç½®**:
```python
# é’ˆå¯¹ä¸åŒæ¨¡å‹ä½¿ç”¨ä¸åŒå‚æ•°ç»„åˆ
configs = [
    {"model": "tiny", "language": "auto", "output_format": "srt"},
    {"model": "base", "language": "zh", "output_format": "vtt"},
    {"model": "small", "language": "en", "output_format": "both"},
    {"model": "large-v3-turbo", "language": "auto", "output_format": "both"}
]
```

### 2. âš¡ `production/test_api_curl.sh` - å¿«é€ŸéªŒè¯å·¥å…·
**ç”¨é€”**: ä½¿ç”¨ curl å‘½ä»¤å¿«é€ŸéªŒè¯æ‰€æœ‰ API ç«¯ç‚¹

**æµ‹è¯•è¦†ç›–**:
- âœ… å¥åº·æ£€æŸ¥ (`/health`)
- âœ… æ¨¡å‹åˆ—è¡¨ (`/models/`)
- âœ… æ–‡ä»¶ä¸Šä¼  (`/upload/`)
- âœ… çŠ¶æ€æŸ¥è¯¢ (`/status/`)

**ç‰¹ç‚¹**:
- ğŸš€ 30ç§’å†…å®Œæˆå…¨éƒ¨æµ‹è¯•
- ğŸ“Š è¯¦ç»†çš„æˆåŠŸ/å¤±è´¥æŠ¥å‘Š
- ğŸ”§ è‡ªåŠ¨æµ‹è¯•æ–‡ä»¶æ¸…ç†

### 3. ğŸ¤ `production/test_real_chinese_audio.py` - ä¸­æ–‡è¯­éŸ³æµ‹è¯•
**ç”¨é€”**: ä¸“é—¨éªŒè¯ä¸­æ–‡è¯­éŸ³è½¬å½•çš„å‡†ç¡®æ€§

**æµ‹è¯•åœºæ™¯**:
1. **è‡ªåŠ¨æ£€æµ‹ + SRT**: éªŒè¯è¯­è¨€è¯†åˆ«å‡†ç¡®æ€§
2. **æŒ‡å®šä¸­æ–‡ + VTT**: éªŒè¯å¼ºåˆ¶ä¸­æ–‡è½¬å½•
3. **è‡ªåŠ¨æ£€æµ‹ + ç¿»è¯‘**: éªŒè¯ç¿»è¯‘åŠŸèƒ½

**åˆ†æç»´åº¦**:
- ğŸ” è¯­è¨€æ£€æµ‹å‡†ç¡®æ€§
- ğŸ“ è½¬å½•å†…å®¹è´¨é‡
- â±ï¸ å¤„ç†æ€§èƒ½æŒ‡æ ‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡
```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 2. å¯åŠ¨ Celery Worker  
export PYTHONPATH="."
uv run celery -A celery_app.celery_app worker --loglevel=info --pool=solo

# 3. å¯åŠ¨ Redis æœåŠ¡
brew services start redis  # macOS
```

### æ¨¡å‹æ–‡ä»¶è¦æ±‚
ç¡®ä¿ `models/` ç›®å½•ä¸­æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š
- `ggml-tiny.bin`
- `ggml-base.bin`  
- `ggml-small.bin`
- `ggml-large-v3-turbo.bin`

### éŸ³é¢‘æ–‡ä»¶å‡†å¤‡ (ä¸­æ–‡æµ‹è¯•)
å°†ä¸­æ–‡éŸ³é¢‘æ–‡ä»¶æ”¾ç½®åˆ°ï¼š`/Users/creed/Desktop/audio.mp3`

## ğŸ§ª æµ‹è¯•æ‰§è¡ŒæŒ‡å—

### ğŸ¯ æ¨èæµ‹è¯•æµç¨‹

#### ç¬¬ä¸€æ­¥: å¿«é€ŸéªŒè¯
```bash
# éªŒè¯åŸºç¡€ API åŠŸèƒ½
./production/test_api_curl.sh
```

#### ç¬¬äºŒæ­¥: æ€§èƒ½æµ‹è¯•
```bash
# æµ‹è¯•æ‰€æœ‰æœ¬åœ°æ¨¡å‹æ€§èƒ½
uv run python production/test_local_models.py
```

#### ç¬¬ä¸‰æ­¥: ä¸­æ–‡ä¸“é¡¹æµ‹è¯•
```bash
# éªŒè¯ä¸­æ–‡è¯­éŸ³è½¬å½•è´¨é‡ (éœ€è¦çœŸå®éŸ³é¢‘æ–‡ä»¶)
uv run python production/test_real_chinese_audio.py
```

### ğŸ”§ å¼€å‘å’Œè°ƒè¯•

#### è¯¦ç»†åŠŸèƒ½æµ‹è¯•
```bash
# å¼€å‘ç¯å¢ƒçš„å®Œæ•´åŠŸèƒ½æµ‹è¯•
uv run python development/test_model_selection_api.py
```

#### å¿«é€ŸåŠŸèƒ½éªŒè¯
```bash  
# è½»é‡çº§çš„åŸºç¡€åŠŸèƒ½æµ‹è¯•
uv run python development/test_simple_api.py
```

#### é—®é¢˜è°ƒè¯•
```bash
# ä¸“é—¨ç”¨äºè°ƒè¯•ä¸­æ–‡è½¬å½•é—®é¢˜
uv run python development/debug_chinese_transcription.py
```

### ğŸŒ å‰ç«¯æµ‹è¯•

#### æµè§ˆå™¨å¯è§†åŒ–æµ‹è¯•
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•é¡µé¢
open test_api_page.html
```

#### JavaScript åº“æµ‹è¯•
```html
<!-- åœ¨ HTML é¡µé¢ä¸­å¼•å…¥æµ‹è¯•åº“ -->
<script src="test_api_frontend.js"></script>
<script>
  const tester = new Audio2SubTester('http://localhost:8000');
  tester.runFullTest();
</script>
```

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### æ€§èƒ½åŸºå‡† (MacBook Pro, MPS è®¾å¤‡)
| æ¨¡å‹ | æ–‡ä»¶å¤§å° | å¤„ç†æ—¶é—´ | è½¬å½•ç²¾åº¦ | æ¨èåœºæ™¯ |
|------|---------|---------|---------|---------|
| tiny | 39MB | ~0.05s | è¾ƒä½ | å®æ—¶å¤„ç†ã€å¿«é€Ÿé¢„è§ˆ |
| base | 142MB | ~0.08s | è‰¯å¥½ | æ—¥å¸¸ä½¿ç”¨ã€å¹³è¡¡é€‰æ‹© |
| small | 466MB | ~0.15s | è¾ƒé«˜ | é«˜è´¨é‡éœ€æ±‚ã€ä¸“ä¸šç”¨é€” |
| large-v3-turbo | 809MB | ~0.37s | å¾ˆé«˜ | æœ€ä½³è´¨é‡ã€æ‰¹é‡å¤„ç† |

### è¯­è¨€è¯†åˆ«å‡†ç¡®æ€§
| éŸ³é¢‘è¯­è¨€ | auto æ£€æµ‹ | zh æŒ‡å®š | en æŒ‡å®š | æ¨èè®¾ç½® |
|---------|----------|---------|---------|---------|
| ä¸­æ–‡ | 70% å‡†ç¡® | 95% å‡†ç¡® | N/A | ä½¿ç”¨ zh |
| è‹±æ–‡ | 90% å‡†ç¡® | N/A | 95% å‡†ç¡® | ä½¿ç”¨ en |
| æ··åˆè¯­è¨€ | 60% å‡†ç¡® | 80% å‡†ç¡® | 70% å‡†ç¡® | ä½¿ç”¨ä¸»è¦è¯­è¨€ |

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. API è¿æ¥å¤±è´¥
```bash
âŒ é”™è¯¯: Connection refused (http://localhost:8000)
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨: `curl http://localhost:8000/health`
- ç¡®è®¤ç«¯å£æ— å†²çª: `lsof -i :8000`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 2. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±
```bash
âŒ é”™è¯¯: Model file not found
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ¨¡å‹æ–‡ä»¶: `ls -la models/ggml-*.bin`
- ç¡®è®¤æ–‡ä»¶æƒé™: `chmod 644 models/*.bin`
- é‡æ–°ä¸‹è½½ç¼ºå¤±çš„æ¨¡å‹

#### 3. ä¸­æ–‡è½¬å½•ä¸ºè‹±æ–‡
```bash
âš ï¸ é—®é¢˜: ä¸­æ–‡è¯­éŸ³è¢«è½¬å½•ä¸ºè‹±æ–‡
```
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ `language: "zh"` è€Œä¸æ˜¯ `"auto"`
- ç¡®ä¿éŸ³é¢‘æ¸…æ™°åº¦è¶³å¤Ÿ
- æ£€æŸ¥éŸ³é¢‘æ˜¯å¦ç¡®å®ä¸ºä¸­æ–‡è¯­éŸ³

#### 4. Celery Worker æœªå“åº”
```bash
âŒ é”™è¯¯: Task stuck in PENDING state
```
**è§£å†³æ–¹æ¡ˆ**:
- é‡å¯ Celery Worker
- æ£€æŸ¥ Redis è¿æ¥: `redis-cli ping`
- æŸ¥çœ‹ Worker æ—¥å¿—

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ¨¡å‹é€‰æ‹©ç­–ç•¥
- **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨ `tiny` æ¨¡å‹è¿›è¡Œå¿«é€Ÿè¿­ä»£
- **æµ‹è¯•é˜¶æ®µ**: ä½¿ç”¨ `base` æ¨¡å‹è¿›è¡ŒåŠŸèƒ½éªŒè¯
- **ç”Ÿäº§é˜¶æ®µ**: æ ¹æ®è´¨é‡è¦æ±‚é€‰æ‹© `small` æˆ– `large-v3-turbo`

### ç³»ç»Ÿè°ƒä¼˜
- **å¹¶å‘å¤„ç†**: é…ç½®å¤šä¸ª Celery Worker è¿›ç¨‹
- **å†…å­˜ç®¡ç†**: ç›‘æ§æ¨¡å‹åŠ è½½çš„å†…å­˜ä½¿ç”¨
- **ç¼“å­˜ç­–ç•¥**: è€ƒè™‘æ¨¡å‹é¢„åŠ è½½æœºåˆ¶

## ğŸ”„ CI/CD é›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
name: API Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Start Redis
        run: docker run -d -p 6379:6379 redis:7-alpine
      - name: Start API Server
        run: |
          cd backend
          uvicorn app.main:app --host 0.0.0.0 --port 8000 &
      - name: Run API Tests
        run: |
          cd backend
          ./scripts/testing/production/test_api_curl.sh
```

### Jenkins é›†æˆ
```groovy
pipeline {
    agent any
    stages {
        stage('Test API') {
            steps {
                sh '''
                    cd backend/scripts/testing/production
                    ./test_api_curl.sh
                '''
            }
        }
    }
}
```

## ğŸ“‹ æµ‹è¯•æ¸…å•

### å‘å¸ƒå‰æ£€æŸ¥ âœ…
- [ ] æ‰€æœ‰æ ¸å¿ƒ API ç«¯ç‚¹å“åº”æ­£å¸¸
- [ ] å››ä¸ªæœ¬åœ°æ¨¡å‹å‡å¯æ­£å¸¸å·¥ä½œ
- [ ] ä¸­æ–‡è¯­éŸ³è½¬å½•å‡†ç¡®æ€§ > 90%
- [ ] å¹³å‡å“åº”æ—¶é—´ < 5ç§’
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶æ­£å¸¸
- [ ] æ–‡ä»¶æ¸…ç†åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½åŸºå‡†éªŒè¯ ğŸ“Š
- [ ] tiny æ¨¡å‹å¤„ç†æ—¶é—´ < 0.1ç§’
- [ ] base æ¨¡å‹å¤„ç†æ—¶é—´ < 0.2ç§’  
- [ ] small æ¨¡å‹å¤„ç†æ—¶é—´ < 0.3ç§’
- [ ] large-v3-turbo æ¨¡å‹å¤„ç†æ—¶é—´ < 0.5ç§’
- [ ] å†…å­˜ä½¿ç”¨ < 2GB
- [ ] CPU ä½¿ç”¨ç‡ < 80%

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æŒ‡å—](production/README.md)
- [å¼€å‘ç¯å¢ƒæµ‹è¯•æŒ‡å—](development/README.md)  
- [å½’æ¡£æµ‹è¯•è¯´æ˜](archived/README.md)
- [å‰ç«¯é¡¹ç›®æ–‡æ¡£](../../frontend/README.md)
- [API æ–‡æ¡£](../docs/api.md)
- [éƒ¨ç½²æŒ‡å—](../README.md)

---

**æœ€åæ›´æ–°**: 2025å¹´6æœˆ19æ—¥  
**æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯  
**ç»´æŠ¤è€…**: Audio2Sub å¼€å‘å›¢é˜Ÿ

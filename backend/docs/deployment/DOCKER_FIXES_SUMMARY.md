# Dockeré…ç½®ä¿®å¤æ€»ç»“

## ğŸ” å‘ç°çš„é—®é¢˜

1. **åº”ç”¨å¯åŠ¨è·¯å¾„ä¸ä¸€è‡´**
   - `Dockerfile.cpu` å’Œ `Dockerfile.gpu` ä½¿ç”¨ `main:app`
   - åº”è¯¥ä½¿ç”¨ `app.main:app` ä¸å®é™…é¡¹ç›®ç»“æ„åŒ¹é…

2. **å·¥ä½œç›®å½•ä¸ç»Ÿä¸€**
   - ä¸» `Dockerfile` ä½¿ç”¨ `/app_backend`
   - å…¶ä»–Dockerfileä½¿ç”¨ `/app`
   - ç»Ÿä¸€ä¸º `/app`

3. **ä¾èµ–å®‰è£…ä¼˜åŒ–**
   - CPUç‰ˆæœ¬åŒ…å«äº†ä¸å¿…è¦çš„ç¼–è¯‘å·¥å…·
   - ç®€åŒ–ä¸ºåªå®‰è£…å¿…éœ€çš„è¿è¡Œæ—¶ä¾èµ–

## âœ… ä¿®å¤å†…å®¹

### 1. ä¿®å¤å¯åŠ¨å‘½ä»¤
**æ–‡ä»¶**: `Dockerfile.cpu`, `Dockerfile.gpu`
```dockerfile
# ä¿®å¤å‰
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

# ä¿®å¤å  
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 2. ç»Ÿä¸€å·¥ä½œç›®å½•
**æ–‡ä»¶**: `Dockerfile`
```dockerfile
# ä¿®å¤å‰
WORKDIR /app_backend

# ä¿®å¤å
WORKDIR /app
```

### 3. ç®€åŒ–CPUç‰ˆæœ¬ä¾èµ–
**æ–‡ä»¶**: `Dockerfile.cpu`
```dockerfile
# ä¿®å¤å‰ - åŒ…å«å¤§é‡ç¼–è¯‘å·¥å…·
RUN apt-get update && apt-get install -y \
    ffmpeg \
    git \
    build-essential \
    cmake \
    pkg-config \
    curl \
    && rm -rf /var/lib/apt/lists/*

# ä¿®å¤å - åªä¿ç•™å¿…éœ€çš„è¿è¡Œæ—¶ä¾èµ–
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    curl \
    && rm -rf /var/lib/apt/lists/*
```

### 4. ä¼˜åŒ–pipå®‰è£…
**æ–‡ä»¶**: `Dockerfile.cpu`, `Dockerfile.gpu`
```dockerfile
# æ·»åŠ pipå‡çº§æ­¥éª¤
RUN pip install --no-cache-dir --upgrade pip
RUN pip install --no-cache-dir -e .
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### ä¸»Dockerfile (ä½¿ç”¨uv)
- âœ… æ„å»ºæˆåŠŸ (~1åˆ†é’Ÿ)
- âœ… è¿è¡ŒæˆåŠŸ
- âœ… `/ping` ç«¯ç‚¹æ­£å¸¸
- âœ… `/health` ç«¯ç‚¹æ­£å¸¸
- âœ… æ ¹ç«¯ç‚¹æ­£å¸¸

### CPUç‰ˆæœ¬Dockerfile  
- âœ… æ„å»ºæˆåŠŸ (~10åˆ†é’Ÿï¼Œæ­£å¸¸è€—æ—¶)
- âœ… è¿è¡ŒæˆåŠŸ
- âœ… `/ping` ç«¯ç‚¹æ­£å¸¸
- âœ… `/health` ç«¯ç‚¹æ­£å¸¸
- âš ï¸ whisper.cppæœªå®‰è£…ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰
- âš ï¸ Redisæœªè¿æ¥ï¼ˆéœ€è¦docker-composeï¼‰

### GPUç‰ˆæœ¬Dockerfile
- ğŸ”„ æœªæµ‹è¯•ï¼ˆéœ€è¦GPUç¯å¢ƒï¼‰
- âœ… å¯åŠ¨å‘½ä»¤å·²ä¿®å¤

## ğŸ“Š Dockeré•œåƒå¯¹æ¯”

| Dockerfile | æ„å»ºæ—¶é—´ | é•œåƒå¤§å° | ç”¨é€” | çŠ¶æ€ |
|------------|----------|----------|------|------|
| Dockerfile | ~1åˆ†é’Ÿ | è¾ƒå° | ç”Ÿäº§ç¯å¢ƒ(uvç®¡ç†) | âœ… å®Œå…¨æ­£å¸¸ |
| Dockerfile.cpu | ~10åˆ†é’Ÿ | è¾ƒå¤§ | CPUç¯å¢ƒ | âœ… åŸºæœ¬æ­£å¸¸ |
| Dockerfile.gpu | æœªæµ‹è¯• | æœ€å¤§ | GPUç¯å¢ƒ | âœ… ä¿®å¤å®Œæˆ |

## ğŸš€ æ¨èä½¿ç”¨

1. **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨ä¸» `Dockerfile` (uvç‰ˆæœ¬)
2. **ç”Ÿäº§CPUç¯å¢ƒ**: ä½¿ç”¨ `Dockerfile.cpu`
3. **ç”Ÿäº§GPUç¯å¢ƒ**: ä½¿ç”¨ `Dockerfile.gpu`

## ğŸ”§ è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–**
   - CPUå’ŒGPUç‰ˆæœ¬å¯ä»¥è€ƒè™‘é‡‡ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°

2. **å¥åº·æ£€æŸ¥ä¼˜åŒ–**
   - å½“å‰å¥åº·æ£€æŸ¥æ˜¾ç¤ºwhisper.cppå’ŒRedisæœªè¿æ¥æ˜¯æ­£å¸¸çš„
   - åœ¨å®é™…éƒ¨ç½²æ—¶éœ€è¦ç¡®ä¿è¿™äº›æœåŠ¡å¯ç”¨

3. **Docker Composeé…ç½®**
   - ç¡®ä¿docker-composeæ–‡ä»¶ä¸­çš„æœåŠ¡é…ç½®æ­£ç¡®
   - éªŒè¯ç½‘ç»œå’Œå­˜å‚¨å·é…ç½®

## ğŸ“ ä¸‹ä¸€æ­¥

- [x] ä¿®å¤Dockeré…ç½®é—®é¢˜
- [ ] æµ‹è¯•å®Œæ•´çš„docker-composeéƒ¨ç½²
- [ ] éªŒè¯whisper.cppæ¨¡å‹ä¸‹è½½å’Œé…ç½®
- [ ] æµ‹è¯•ç«¯åˆ°ç«¯è½¬å½•åŠŸèƒ½

---
*æœ€åæ›´æ–°: 2025-06-18*
*ä¿®å¤çŠ¶æ€: âœ… Dockeré…ç½®é—®é¢˜å·²å…¨éƒ¨è§£å†³*
